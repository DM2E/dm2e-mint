/*!
  Evol.ColorPicker 2.1
 
  Copyright (c) 2013, Olivier Giulieri 
 
  Depends:
  jquery.ui.core.js
  jquery.ui.widget.js
 */
(function(e,t){var n=0,r=!e.support.cssFloat,i=r?"-ie":"",s=r?false:/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase()),o=[],u=["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],a=["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada","d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5","bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f","a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09","7f7f7f","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"],f=["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],l=[["003366","336699","3366cc","003399","000099","0000cc","000066"],["006666","006699","0099cc","0066cc","0033cc","0000ff","3333ff","333399"],["669999","009999","33cccc","00ccff","0099ff","0066ff","3366ff","3333cc","666699"],["339966","00cc99","00ffcc","00ffff","33ccff","3399ff","6699ff","6666ff","6600ff","6600cc"],["339933","00cc66","00ff99","66ffcc","66ffff","66ccff","99ccff","9999ff","9966ff","9933ff","9900ff"],["006600","00cc00","00ff00","66ff99","99ffcc","ccffff","ccccff","cc99ff","cc66ff","cc33ff","cc00ff","9900cc"],["003300","009933","33cc33","66ff66","99ff99","ccffcc","ffffff","ffccff","ff99ff","ff66ff","ff00ff","cc00cc","660066"],["333300","009900","66ff33","99ff66","ccff99","ffffcc","ffcccc","ff99cc","ff66cc","ff33cc","cc0099","993399"],["336600","669900","99ff33","ccff66","ffff99","ffcc99","ff9999","ff6699","ff3399","cc3399","990099"],["666633","99cc00","ccff33","ffff66","ffcc66","ff9966","ff6666","ff0066","d60094","993366"],["a58800","cccc00","ffff00","ffcc00","ff9933","ff6600","ff0033","cc0066","660033"],["996633","cc9900","ff9900","cc6600","ff3300","ff0000","cc0000","990033"],["663300","996600","cc3300","993300","990000","800000","993333"]],c=function(e){var t=e.toString(16);if(t.length==1){t="0"+t}return t},h=function(e){return c(Number(e))},p=function(e){var t=c(e);return t+t+t},d=function(e){if(e.length>10){var t=1+e.indexOf("("),n=e.indexOf(")"),r=e.substring(t,n).split(",");return["#",h(r[0]),h(r[1]),h(r[2])].join("")}else{return e}};e.widget("evol.colorpicker",{version:"2.1",options:{color:null,showOn:"both",displayIndicator:true,history:true,strings:"Theme Colors,Standard Colors,More Colors,Less Colors,Back to Palette,History,No history yet."},_create:function(){this._paletteIdx=1;this._id="evo-cp"+n++;this._enabled=true;var t=this;switch(this.element.get(0).tagName){case"INPUT":var o=this.options.color,u=this.element;this._isPopup=true;this._palette=null;if(o!=null){u.val(o)}else{var a=u.val();if(a!=""){o=this.options.color=a}}u.addClass("colorPicker "+this._id).wrap('<div style="width:'+(this.element.width()+32)+"px;"+(r?"margin-bottom:-21px;":"")+(s?"padding:1px 0;":"")+'"></div>').after('<div class="evo-colorind'+(s?"-ff":i)+'" '+(o!=null?'style="background-color:'+o+'"':"")+"></div>").on("keyup onpaste",function(n){var r=e(this).val();if(r!=t.options.color){t._setValue(r,true)}});var f=this.options.showOn;if(f=="both"||f=="focus"){u.on("focus",function(){t.showPalette()})}if(f=="both"||f=="button"){u.next().on("click",function(e){e.stopPropagation();t.showPalette()})}break;default:this._isPopup=false;this._palette=this.element.html(this._paletteHTML()).attr("aria-haspopup","true");this._bindColors()}if(o!=null&&this.options.history){this._add2History(o)}},_paletteHTML:function(){var e=[],t=this._paletteIdx=Math.abs(this._paletteIdx),n=this.options,r=n.strings.split(",");e.push('<div class="evo-pop',i,' ui-widget ui-widget-content ui-corner-all"',this._isPopup?' style="position:absolute"':"",">");e.push("<span>",this["_paletteHTML"+t](),"</span>");e.push('<div class="evo-more"><a href="javascript:void(0)">',r[1+t],"</a>");if(n.history){e.push('<a href="javascript:void(0)" class="evo-hist">',r[5],"</a>")}e.push("</div>");if(n.displayIndicator){e.push(this._colorIndHTML(this.options.color,"left"),this._colorIndHTML("","right"))}e.push("</div>");return e.join("")},_colorIndHTML:function(e,t){var n=[];n.push('<div class="evo-color" style="float:left"><div style="');n.push(e?"background-color:"+e:"display:none");if(r){n.push('" class="evo-colorbox-ie"></div><span class=".evo-colortxt-ie" ')}else{n.push('"></div><span ')}n.push(e?">"+e+"</span>":"/>");n.push("</div>");return n.join("")},_paletteHTML1:function(){var e=[],t=this.options.strings.split(","),n='<td style="background-color:#',s=r?'"><div style="width:2px;"></div></td>':'"><span/></td>',o='<tr><th colspan="10" class="ui-widget-content">';e.push('<table class="evo-palette',i,'">',o,t[0],"</th></tr><tr>");for(var l=0;l<10;l++){e.push(n,u[l],s)}e.push("</tr>");if(!r){e.push('<tr><th colspan="10"></th></tr>')}e.push('<tr class="top">');for(var l=0;l<10;l++){e.push(n,a[l],s)}for(var c=1;c<4;c++){e.push('</tr><tr class="in">');for(var l=0;l<10;l++){e.push(n,a[c*10+l],s)}}e.push('</tr><tr class="bottom">');for(var l=40;l<50;l++){e.push(n,a[l],s)}e.push("</tr>",o,t[1],"</th></tr><tr>");for(var l=0;l<10;l++){e.push(n,f[l],s)}e.push("</tr></table>");return e.join("")},_paletteHTML2:function(){var e=[],t='<td style="background-color:#',n=r?'"><div style="width:5px;"></div></td>':'"><span/></td>',s='<table class="evo-palette2'+i+'"><tr>',o="</tr></table>";e.push('<div class="evo-palcenter">');for(var u=0,a=l.length;u<a;u++){e.push(s);var f=l[u];for(var c=0,h=f.length;c<h;c++){e.push(t,f[c],n)}e.push(o)}e.push('<div class="evo-sep"/>');var d=[];e.push(s);for(var c=255;c>10;c-=10){e.push(t,p(c),n);c-=10;d.push(t,p(c),n)}e.push(o,s,d.join(""),o);e.push("</div>");return e.join("")},_switchPalette:function(t){if(this._enabled){var n=this.options.strings.split(",");if(e(t).hasClass("evo-hist")){var r=['<table class="evo-palette"><tr><th class="ui-widget-content">',n[5],"</th></tr></tr></table>",'<div class="evo-cHist">'];if(o.length==0){r.push("<p> ",n[6],"</p>")}else{for(var i=o.length-1;i>-1;i--){r.push('<div style="background-color:',o[i],'"></div>')}}r.push("</div>");var s=-this._paletteIdx,u=r.join(""),a=n[4]}else{if(this._paletteIdx<0){var s=-this._paletteIdx;this._palette.find(".evo-hist").show()}else{var s=this._paletteIdx==2?1:2}var u=this["_paletteHTML"+s](),a=n[s+1];this._paletteIdx=s}this._paletteIdx=s;var f=this._palette.find(".evo-more").prev().html(u).end().children().eq(0).html(a);if(s<0){f.next().hide()}}},showPalette:function(){if(this._enabled){e(".colorPicker").not("."+this._id).colorpicker("hidePalette");if(this._palette==null){this._palette=this.element.next().after(this._paletteHTML()).next().on("click",function(e){e.stopPropagation()});this._bindColors();var t=this;e(document.body).on("click."+this._id,function(e){if(e.target!=t.element.get(0)){t.hidePalette()}})}}return this},hidePalette:function(){if(this._isPopup&&this._palette){e(document.body).off("click."+this._id);var t=this;this._palette.off("mouseover click","td").fadeOut(function(){t._palette.remove();t._palette=t._cTxt=null}).find(".evo-more a").off("click")}return this},_bindColors:function(){var t=this._palette.find("div.evo-color"),n=this.options.history?"td,.evo-cHist div":"td";this._cTxt1=t.eq(0).children().eq(0);this._cTxt2=t.eq(1).children().eq(0);var r=this;this._palette.on("click",n,function(t){if(r._enabled){var n=d(e(this).attr("style").substring(17));r._setValue(n)}}).on("mouseover",n,function(t){if(r._enabled){var n=d(e(this).attr("style").substring(17));if(r.options.displayIndicator){r._setColorInd(n,2)}r.element.trigger("mouseover.color",n)}}).find(".evo-more a").on("click",function(){r._switchPalette(this)})},val:function(e){if(typeof e=="undefined"){return this.options.color}else{this._setValue(e);return this}},_setValue:function(e,t){e=e.replace(/ /g,"");this.options.color=e;if(this._isPopup){if(!t){this.hidePalette()}this.element.val(e).next().attr("style","background-color:"+e)}else{this._setColorInd(e,1)}if(this.options.history&&this._paletteIdx>0){this._add2History(e)}this.element.trigger("change.color",e)},_setColorInd:function(e,t){this["_cTxt"+t].attr("style","background-color:"+e).next().html(e)},_setOption:function(e,t){if(e=="color"){this._setValue(t,true)}else{this.options[e]=t}},_add2History:function(e){var t=o.length;for(var n=0;n<t;n++){if(e==o[n]){return}}if(t>27){o.shift()}o.push(e)},enable:function(){var e=this.element;if(this._isPopup){e.removeAttr("disabled")}else{e.css({opacity:"1","pointer-events":"auto"})}e.removeAttr("aria-disabled");this._enabled=true;return this},disable:function(){var e=this.element;if(this._isPopup){e.attr("disabled","disabled")}else{this.hidePalette();e.css({opacity:"0.3","pointer-events":"none"})}e.attr("aria-disabled","true");this._enabled=false;return this},isDisabled:function(){return!this._enabled},destroy:function(){e(document.body).off("click."+this._id);if(this._palette){this._palette.off("mouseover click","td").find(".evo-more a").off("click");if(this._isPopup){this._palette.remove()}this._palette=this._cTxt=null}if(this._isPopup){this.element.next().off("click").remove().end().off("focus").unwrap()}this.element.removeClass("colorPicker "+this.id).empty();e.Widget.prototype.destroy.call(this)}})})(jQuery)